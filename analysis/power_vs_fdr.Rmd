---
title: "Power vs. FDR plots for paper"
author: Yuxin Zou and Peter Carbonetto
output: workflowr::wflow_html
---

*Add text here.*

```{r knitr-opts, include=FALSE}
knitr::opts_chunk$set(comment = "#",collapse = TRUE,results = "hold",
                      fig.show = "hold",fig.align = "center",dpi = 120)
```

Load some packages used to create the power vs. FDR plots:

```{r load-pkgs, message=FALSE}
library(ggplot2)
library(cowplot)
```

Load the results from the UK Biobank simulations:

```{r load-results}
res = readRDS("data/roc_data.rds")
```

Create the power vs. FDR plot comparing different fine-mapping methods
when they are provided with the "in sample" LD:

```{r in-sample, fig.height=3, fig.width=4.5}
pdat <-
  rbind(data.frame(method = "susie-suff",
                   fdr    = 1 - res[["susie-suff-refineTRUE"]]$pr[,1],
			       power  = res[["susie-suff-refineTRUE"]]$pr[,2],
			       thresh = res[["susie-suff-refineTRUE"]]$pr[,3]),
        data.frame(method = "susie-rss",
                   fdr    = 1 - res[["susie-rss-L10-refineTRUE-LDin"]]$pr[,1],
                   power  = res[["susie-rss-L10-refineTRUE-LDin"]]$pr[,2],
                   thresh = res[["susie-rss-L10-refineTRUE-LDin"]]$pr[,3]),
        data.frame(method = "susie-rss,L=true",
                   fdr    = 1-res[["susie-rss-oracle-refineTRUE-LDin"]]$pr[,1],
                   power  = res[["susie-rss-oracle-refineTRUE-LDin"]]$pr[,2],
                   thresh = res[["susie-rss-oracle-refineTRUE-LDin"]]$pr[,3]),
        data.frame(method = "finemap",
                   fdr    = 1 - res[["FINEMAP-L4-LDin"]]$pr[,1],
                   power  = res[["FINEMAP-L4-LDin"]]$pr[,2],
                   thresh = res[["FINEMAP-L4-LDin"]]$pr[,3]),
        data.frame(method = "finemap,L=true",
                   fdr    = 1 - res[["FINEMAP-oracle-LDin"]]$pr[,1],
                   power  = res[["FINEMAP-oracle-LDin"]]$pr[,2],
                   thresh = res[["FINEMAP-oracle-LDin"]]$pr[,3]),
        data.frame(method = "dap-g",
                   fdr    = 1 - res[["DAP-G-LDin"]]$pr[,1],
                   power  = res[["DAP-G-LDin"]]$pr[,2],
                   thresh = res[["DAP-G-LDin"]]$pr[,3]),
        data.frame(method = "caviar",
                   fdr    = 1 - res[["CAVIAR-LDin"]]$pr[,1],
                   power  = res[["CAVIAR-LDin"]]$pr[,2],
                   thresh = res[["CAVIAR-LDin"]]$pr[,3]))
rows <- with(pdat,order(method,fdr))
pdat <- pdat[rows,]
p <- ggplot(pdat,aes(x = fdr,y = power,color = method,linetype = method)) +
  geom_line(orientation = "y") +
  geom_point(data = subset(pdat,thresh == 0.95),show.legend = FALSE) +
  scale_color_manual(values = c("black","magenta","magenta","darkorange",
                                "darkorange","dodgerblue","limegreen")) +
  scale_linetype_manual(values = c("dotted","solid","dashed","solid",
                                   "dashed","solid","solid")) +
  scale_x_continuous(breaks = seq(0,0.3,0.05)) +
  scale_y_continuous(breaks = seq(0,0.3,0.05)) +
  coord_cartesian(xlim = c(0,0.3),ylim = c(0,0.3)) +
  theme_cowplot(font_size = 12)
print(p)
```

```{r in-sample-for-paper, echo=FALSE, message=FALSE}
ggsave("pip_power_vs_fdr_insample.pdf",p,height=3,width=4.3)
```
